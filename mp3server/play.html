<html>
  <head>
    <title>MP3 server: {{song}}</title>
    <script type='text/javascript' src='/local/soundmanager2.js'></script>
    <script type="text/javascript" src="http://www.google.com/jsapi"></script>
    <script type="text/javascript">google.load("prototype", "1.6.0.2");</script>

    <script type='text/javascript'>
      function pad(digit) {
        if (digit < 10)
          return ("0" + digit);
        else
          return digit;
      }

      soundManager.useHighPerformance = false;
      soundManager.url = '/local/soundmanager2.swf';
      soundManager.debugMode = false;
      soundManager.onload = function() {
        var mySound = soundManager.createSound({
          id: 'aSound',
          url: encodeURI("{{mp3_url}}"),
          onfinish:songFinished,
        });

	mySound.options.whileplaying = function() {
	  var position = Math.floor(mySound.position / 1000);
	  var position_min = Math.floor(position / 60);
	  var position_sec = pad(position - (position_min * 60));

	  var duration = Math.floor(mySound.duration / 1000);
	  var duration_min = Math.floor(duration / 60);
	  var duration_sec = pad(duration - (duration_min * 60));

          document.getElementById("position").innerHTML = position_min + ":" + position_sec + " of " + duration_min + ":" + duration_sec;
        }

        mySound.play();
      }

      function goNext() {
        window.location = "/play";
      }
      function songFinished() {
        new Ajax.Request("/done/{{id}}", {method:'get', onSuccess:goNext});
      }
    </script>
  </head>
  <body>
    <button onClick="soundManager.togglePause('aSound');">Pause</button>
    <button onClick="soundManager.stop('aSound');">Stop</button>
    <button onClick="goNext();">Next</button>

    <br/><br/>

    <table width=100%>
    <tr><td>
        Artist: {{artist}}<br/>
        Album: {{album}}<br/>
        Song: <i>{{number}} {{song}}</i><br/>
        Play count: {{plays}}<br/>
        Skip count: {{skips}}<br/><br/>
    </td><td>
        <font size=+5><span id="position">...</span></font>
    </td></tr>
    </table>

    <br/><br/>

    Tags: {{tags}}<br/>
    Paths: {{paths}}

    <br/><br/>

    <table width=100%>
    <tr><td></td><td>Count</td>
                 <td>Most played</td>
                 <td>Plays</td>
                 <td>Most skipped</td>
                 <td>Skips</td></tr>
    <tr><td>Today</td><td></td>
                      <td></td>
                      <td>{{today_countplays}}</td>
                      <td></td>
                      <td>{{today_countskips}}</td></tr>
     <tr><td>Ever</td><td>{{ever_count}}</td>
                      <td>{{ever_maxplays}}</td>
                      <td>{{ever_sumplays}}</td>
                      <td>{{ever_maxskips}}</td>
                      <td>{{ever_sumskips}}</td></tr>
    </table>

    <br/><br/>

    <img src="{{graph}}">

  </body>
</html>
